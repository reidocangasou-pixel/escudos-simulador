<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Simulador de Partidas com IA - QG DAS IDEIAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif !important; background-color:#111827; color:#FFFFFF !important; }
        .text-white-override * { color: #FFFFFF !important; }
        .qg-card { background-color:#1f2937; border-radius:.75rem; border:1px solid #374151; box-shadow:0 10px 15px -3px rgba(0,0,0,.3),0 4px 6px -2px rgba(0,0,0,.2); }
        .qg-card * { color:#FFFFFF !important; }
        .qg-card label { color: #d1d5db !important; }
        .qg-card input, .qg-card select { background-color:#374151 !important; border-color:#4b5563 !important; color: #fff !important; }
        .qg-title { font-weight:800; color:#f9a826 !important; }
        .qg-subtitle { color:#eab308 !important; }
        .loader { border:4px solid #4b5563; border-radius:50%; border-top:4px solid #f9a826; width:40px; height:40px; animation:spin 2s linear infinite; margin:20px auto; }
        @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

        .scoreboard { display:flex; justify-content:space-around; align-items:center; padding:1rem; background-color:#111827; border-radius:.5rem; border:2px solid #374151; }
        .team { display:flex; flex-direction:column; align-items:center; width:120px; }
        .team img { 
            width:70px; 
            height:70px; 
            object-fit:contain; 
            background: rgba(255,255,255,0.05);
            border-radius:6px; 
            padding:4px; 
        }
        .team-name { font-weight:bold; margin-top:.5rem; font-size:.9rem; text-align:center; }
        .score { font-size:3rem; font-weight:800; }
        .match-event { background-color:rgba(255,255,255,0.05); border-left:4px solid #f9a826; padding:1rem; margin-top:1rem; border-radius:0 8px 8px 0; animation:fadeIn .5s ease-in-out; }
        @keyframes fadeIn { from {opacity:0; transform:translateX(-20px)} to {opacity:1; transform:translateX(0)} }

        @media (max-width: 640px) {
            .score { font-size:2rem; }
            .team { width:90px; }
            .team img { width:56px; height:56px; }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="qg-post-container" class="w-full max-w-2xl">
        <article class="prose prose-lg max-w-none">
            <header class="text-center mb-8 text-white-override">
                <h1 class="qg-title text-4xl md:text-5xl">O Or√°culo da Rodada ‚öΩ</h1>
                <h2 class="qg-subtitle text-2xl md:text-3xl mt-2">Simule o Jogo do seu Time com a IA do QG!</h2>
            </header>

            <div class="qg-card p-6 md:p-8">
                <div class="text-center mb-6">
                    <p>Escolha os times, aperte o play e deixe a IA narrar o destino da partida! Quem leva a melhor nesse confronto?</p>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="home-team" class="block mb-2 font-medium">Time da Casa</label>
                        <select id="home-team" class="w-full p-2 border rounded-md shadow-sm"></select>
                    </div>
                    <div>
                        <label for="away-team" class="block mb-2 font-medium">Time Visitante</label>
                        <select id="away-team" class="w-full p-2 border rounded-md shadow-sm"></select>
                    </div>
                </div>

                <div class="scoreboard mb-6">
                    <div class="team">
                        <img id="home-logo" src="" alt="Escudo Time da Casa">
                        <span id="home-name" class="team-name">Casa</span>
                    </div>
                    <div class="score">
                        <span id="home-score">0</span> x <span id="away-score">0</span>
                    </div>
                    <div class="team">
                        <img id="away-logo" src="" alt="Escudo Time Visitante">
                        <span id="away-name" class="team-name">Visitante</span>
                    </div>
                </div>

                <button id="simulate-btn" class="w-full bg-yellow-500 text-gray-900 font-bold py-3 px-6 rounded-lg hover:bg-yellow-400 transition duration-300 text-lg">
                    Simular Partida
                </button>

                <div id="match-summary" class="mt-6 text-left min-h-[150px] bg-gray-800 p-4 rounded-md border border-gray-700">
                    <p class="text-center">A cr√¥nica da partida aparecer√° aqui...</p>
                </div>
            </div>
        </article>
    </div>
<script>
/*
  IMPORTANTE: Antes de colar no Blogger, voc√™ PRECISA substituir 
  o valor da constante LOGOS_BASE_URL abaixo pela URL base dos seus 
  escudos hospedados no GitHub (veja o Passo 1 do guia).
*/
const LOGOS_BASE_URL = "https://github.com/reidocangasou-pixel/escudos-simulador/blob/main/Simuladoroficial";

const teams = [
  "Atl√©tico-MG","Bahia","Botafogo","Cear√°","Corinthians","Cruzeiro","Flamengo","Fluminense",
  "Fortaleza","Juventude","Gr√™mio","Internacional","Mirassol","Palmeiras","RB Bragantino",
  "Santos","S√£o Paulo","Sport","Vasco","Vit√≥ria"
].map(name => {
    const slug = name.toLowerCase()
        .replace(/\s+br\b/g,'') 
        .replace(/[\s\.]+/g,'-')
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-z0-9\-]/g,'')
        .replace(/\-+/g,'-')
        .replace(/^\-|\-$/g,'');
    
    // Constr√≥i a URL completa para cada logo
    return { name, slug, logo: `${LOGOS_BASE_URL}/${slug}.png` };

}).sort((a,b) => a.name.localeCompare(b.name));

const homeTeamSelect = document.getElementById('home-team');
const awayTeamSelect = document.getElementById('away-team');
const homeLogo = document.getElementById('home-logo');
const awayLogo = document.getElementById('away-logo');
const homeName = document.getElementById('home-name');
const awayName = document.getElementById('away-name');
const homeScoreEl = document.getElementById('home-score');
const awayScoreEl = document.getElementById('away-score');
const simulateBtn = document.getElementById('simulate-btn');
const summaryEl = document.getElementById('match-summary');

function populateSelects(){
    teams.forEach((t) => {
        const o1 = document.createElement('option');
        o1.value = t.name;
        o1.textContent = t.name;
        homeTeamSelect.appendChild(o1);

        const o2 = document.createElement('option');
        o2.value = t.name;
        o2.textContent = t.name;
        awayTeamSelect.appendChild(o2);
    });

    homeTeamSelect.selectedIndex = Math.floor(Math.random() * teams.length);
    do {
       awayTeamSelect.selectedIndex = Math.floor(Math.random() * teams.length);
    } while(awayTeamSelect.selectedIndex === homeTeamSelect.selectedIndex);
    
    updateTeamInfo();
}

function updateTeamInfo(){
    const home = teams.find(t => t.name === homeTeamSelect.value);
    const away = teams.find(t => t.name === awayTeamSelect.value);
    
    if(home){
        homeLogo.src = home.logo;
        homeName.textContent = home.name;
    }
    if(away){
        awayLogo.src = away.logo;
        awayName.textContent = away.name;
    }
}

homeTeamSelect.addEventListener('change', updateTeamInfo);
awayTeamSelect.addEventListener('change', updateTeamInfo);

async function callGeminiAPI(prompt, schema, resultContainer, buttonEl) {
    resultContainer.innerHTML = '<div class="loader"></div>';
    if (buttonEl) buttonEl.disabled = true;

    const apiKey = ""; 

    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
    const payload = {
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
            responseMimeType: "application/json",
            responseSchema: schema
        }
    };

    try {
        const response = await fetch(apiUrl, { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify(payload) 
        });
        if (!response.ok) {
            const errorBody = await response.json();
            const errorMessage = errorBody?.error?.message || `Status: ${response.status}`;
            throw new Error(`Falha na chamada da API: ${errorMessage}`);
        }
        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
        if (!text) throw new Error("A resposta da API estava vazia ou em formato incorreto.");
        return JSON.parse(text);
    } catch (error) {
        console.error("Erro na API ou no processamento:", error);
        resultContainer.innerHTML = `<p class="text-red-500 text-center"><b>Ocorreu um erro ao gerar a simula√ß√£o:</b><br><small>${error.message}</small></p>`;
        return null;
    } finally {
        if (buttonEl) buttonEl.disabled = false;
    }
}

async function simulateMatch() {
    const homeTeamName = homeTeamSelect.value;
    const awayTeamName = awayTeamSelect.value;

    if (homeTeamName === awayTeamName) {
        summaryEl.innerHTML = `<p class="text-amber-400 text-center font-bold">Escolha times diferentes para a simula√ß√£o! üòâ</p>`;
        return;
    }

    homeScoreEl.textContent = '0';
    awayScoreEl.textContent = '0';

    const schema = {
        type: "OBJECT",
        properties: {
            placar_casa: { type: "NUMBER", description: "N√∫mero de gols do time da casa." },
            placar_visitante: { type: "NUMBER", description: "N√∫mero de gols do time visitante." },
            eventos: {
                type: "ARRAY",
                description: "Uma lista de eventos da partida, principalmente gols. Cada evento deve ter minuto, time e descri√ß√£o.",
                items: {
                    type: "OBJECT",
                    properties: {
                        minuto: { type: "NUMBER", description: "Minuto em que o evento ocorreu." },
                        time: { type: "STRING", description: "Nome do time que realizou o evento (usar o nome exato fornecido no prompt)." },
                        descricao: { type: "STRING", description: "Descri√ß√£o curta e emocionante do gol." }
                    },
                    required: ["minuto", "time", "descricao"]
                }
            }
        },
        required: ["placar_casa", "placar_visitante", "eventos"]
    };

    const prompt = `Aja como um narrador de futebol brasileiro carism√°tico e criativo. Crie uma cr√¥nica resumida e emocionante para um jogo de futebol entre ${homeTeamName} (time da casa) e ${awayTeamName} (time visitante). O resultado deve ser aleat√≥rio e plaus√≠vel (de 0 a 4 gols para cada time est√° bom). Descreva os lances dos gols de forma breve e vibrante. Forne√ßa a resposta estritamente como um objeto JSON v√°lido, seguindo o schema fornecido.`;

    const result = await callGeminiAPI(prompt, schema, summaryEl, simulateBtn);

    if(result && typeof result.placar_casa !== 'undefined'){
        homeScoreEl.textContent = result.placar_casa;
        awayScoreEl.textContent = result.placar_visitante;

        let summaryHtml = '<h4 class="font-bold text-lg text-center text-yellow-400 mb-4">Cr√¥nica da Partida</h4>';
        if(!result.eventos || result.eventos.length === 0) {
            summaryHtml += `<p class="text-center">Um jogo morno, rapaziada! O 0 a 0 persistiu no placar, com as defesas levando a melhor sobre os ataques. Faltou aquele tempero!</p>`;
        } else {
             result.eventos.sort((a, b) => a.minuto - b.minuto).forEach(event => {
                 summaryHtml += `
                     <div class="match-event">
                         <p class="font-bold">‚è±Ô∏è ${event.minuto}' - GOL DO ${event.time.toUpperCase()}!</p>
                         <p>${event.descricao}</p>
                     </div>
                 `;
             });
        }
         summaryEl.innerHTML = summaryHtml;
    }
}


document.addEventListener('DOMContentLoaded', () => {
    populateSelects();
    simulateBtn.addEventListener('click', simulateMatch);
});
</script>
</body>
</html>

